# Build script for Travis CI
#

# use fast-boot container-based hosts
dist: xenial

# no need to check for oracle's java
language: java
jdk: openjdk8

# speed up builds by caching maven local repository
cache:
  directories:
  - "$HOME/.m2/repository"

# as agreed in our SOP
branches:
  only:
  - master
  - development

# added to make logs look cleaner, crisper, certified fresh
before_install: unset _JAVA_OPTIONS

# speed up builds by telling Travis that we don't need any special "installation"
install: true

# check if we need to add a license file for Vaadin charts
before_script: if [ "$VAADIN_CHARTS_LICENSE_CODE" != "" ]; then
  echo "$VAADIN_CHARTS_LICENSE_CODE" > ~/.vaadin.charts.developer.license;
  fi;

# as agreed in our SOP, build everything (don't deploy, just try to 'mvn install' locally, which covers all phases)
script: mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml clean cobertura:cobertura install
# upload code coverage report, generate maven site (javadocs, documentation, static code analysis, etc.)
after_success:
- bash <(curl -s https://codecov.io/bash)
- mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml site

# upload to maven
deploy:
# as agreed in our SOP, builds on development branch will deploy to our maven repository after validating
# the artifact has a proper SNAPSHOT version
# artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles development-build,!release-build --settings .travis.settings.xml deploy
  on:
    branch: development
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'
  # as agreed in our SOP, tagging a commit on the master branch will upload to our maven repository
  # after validating the artifact has a proper release version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles !development-build,release-build --settings .travis.settings.xml deploy
  on:
    branch: master
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'

env:
  global:
    - secure: "kDWK6fbUCd5Chs1ZuUQN489FxLZ6e3VsCvn3Zooz3cF1+lLHNimRciNqsLuq3AleedhWYxdTO7LkHOkgkiMsmejl/1JdINyW+ehrvX9WkKyMOr8Zf0hITs322GC+Kt+WoZw0YgtGZs1cWOvBJKqR8+H1OCBUVIAyQqrnM8xQHjfcWXR/6foj1Wu4Hideqwe5tZ1ZeG58lBxeL7L3I9Bz9QC0AaEztpAYOju2VsbMGBPB5wauXTfAbY93c4rCuc2WDblUbOvJUYZ5esZl2J9bEMfuwzq0tTitgGBDRmA+Bwl+GLVvdK3huUQtzXwkdPCIJXyWJP4jq9LxM1e4OA4IigoTA4hBGKO1WBH5eiJEdRLY2MURDKIDe1of8gWjo/1WuYSDG5xmFXYwJGYeftdfFSzrlp/q+BCd+YUTPgBIuSXUzchBriCV/VXihE2iQb1eAJsDY7Jt1wJEgrfV+fjEW3bHLnAxirEEEUii8vD9ctgF9M4QGrQ+L0mv2/wX4f8fv0DyzCKXq35XUHXFPJk8ZjPMjYOx/FEYPpgHRjUdOZCajzXEBCtaf+rE7a3PpB7am+s1awYzqmwDqRnNCVxa+HxEf/lrti+mEfXEIvRRm0BFcEXks9eUnolvb77z0eZdoWf9lF7rVZ61677i9bOHCeQurtn97uKOo5uAvwwUv9c="
    - secure: "QSHIo6bPuSSD9nHxG3dLPXfVJEWX8JkJqnPqGN9RL2R6z7h7Pqnsh5F/8BId/MQPxcdGoFMJ1LuMSpwLZvvnVqjH5VQHQBVIBCgpLpOYsiIOKYXDbMI1yYUoJ3ai4jpGSrjBM/WJjuOk7C7Lnv51m/LzdD4TdpV6IcEOaJMFlzjkKEuw27ilzkRtUMAy1wbEFyBCo9czBN138EWwFUEfUl0WP9uekMFHh4SrdoRYX4TqfpwehS0sIri2dKZWjGlyEffntJqj5nWe0qzjczJum8dkCXMz+UJnWeYFEIoKQXH0rxqRR9VvN7Nnj5ON6WsQNoaEH+w7IWX+kWnwb2BLqBXlPh5x8d5DRi7BuZL3f19z9JL8nAtKN0VsjdvlrXsov3k+OSXRIjSHX/zGi1S6kPfWr3VG5mn3gNZb0Q89V81l63Ty/u7BibxzeH9mDSjMDLcweorUGybPFqoQ0gGg7cza+k3u14ksjnCXRL5TWuFpBREYxmLaNrtu+jEl6bOEG+y7Uo9fp7Yfb99+0Q5Tnf+KYXu3FT0o38GXaY/Q0a8xk+h1tNIHmoognXRl7MPL2OG+QDiKMzmw2JZvyfT2t4IG2g3ZStYMguf1MYxCL+SqoiMxBc8wub8Ukto78hAX39vz5uBPA64WnI/+SQPTR6DEvEfXCJVzzb0Lt1iHH34="


# change according to your needs, but we recommend to deactivate email notifications
# for now, we configured Travis to send a notification to the #travis-ci channel 
notifications:
  email:
    on_success: never
    on_failure: never
  slack:
    on_success: never
    on_failure: always
    # edit the following section if you want to get slack notifications
    rooms:
    - secure: "***"
